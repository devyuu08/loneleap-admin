# 🛡️ LoneLeap 관리자 페이지 (Next.js)

> 혼자 여행 플랫폼의 신고 관리, 사용자 관리, 추천 여행지 관리를 위한 Next.js 기반 관리자 페이지입니다. 서버 렌더링(SSR) 구조로 되어 있으며, Firebase Admin SDK를 활용하여 보안과 기능을 분리했습니다.

---

## **1. 📌 프로젝트 개요**

LoneLeap 관리자 페이지는 플랫폼 운영을 위한 백오피스 웹 애플리케이션입니다. 리뷰/채팅 신고 처리, 사용자 계정 관리, 추천 여행지 등록/수정, 통계 대시보드 등 콘텐츠 품질을 유지하고 유저 행동을 분석하는 기능을 제공합니다.

- 개발 기간: 2025.04 ~ 2025.06
- 기술 스택: **Next.js (Pages Router)**, Firebase Admin SDK, Tailwind CSS
- 주요 역할: 클라이언트와 분리된 전용 관리자 시스템

---

## **2. 🛠️ 기술 스택**

- **Next.js (Pages Router)**

  - 서버사이드 렌더링 기반 라우팅
  - `getServerSideProps`를 통한 인증 및 데이터 패칭

- **Firebase Admin SDK**

  - 서버에서 Firestore 접근 및 사용자 계정 관리
  - 관리자 인증 및 토큰 검증 처리

- **Firebase Authentication**

  - 클라이언트 로그인 처리 (이메일/비밀번호)
  - 로그인 후 서버 쿠키에 토큰 저장

- **HttpOnly Cookie 기반 인증**

  - 관리자 인증 토큰을 쿠키로 저장하여 보안 강화
  - 서버에서만 접근 가능한 `HttpOnly` 속성 사용

- **Tailwind CSS**

  - 반응형 UI 구현
  - 디자인 호텔 스타일을 참고한 감성적 관리자 UI

- **Recharts**

  - 대시보드 통계 시각화 (라인, 바, 도넛 차트 등)

---

## **3. 📁 폴더 구조(요약)**

```bash
loneleap-admin/
├── .env.local                    # 환경 변수 설정 (Firebase Admin, 관리자 이메일 등)
├── components/                  # 공통 UI 컴포넌트
├── hooks/                       # 커스텀 훅
├── lib/                         # 서버 사이드 로직 및 유틸리티
│   ├── auth.js                  # 토큰 검증 및 인증 유틸
│   ├── cookies.js               # 쿠키 설정 및 삭제
│   ├── firebase.js              # Firebase Client SDK (사용자 로그인 등)
│   ├── firebaseAdmin.js         # Firebase Admin SDK 초기화
│   ├── uploadImage.js           # Firebase Storage 이미지 업로드 처리
│   ├── admin.js                 # 관리자 관련 유틸
│   ├── users.js                 # 사용자 관리 관련 유틸
│   └── utils.js                 # 공통 유틸 함수
├── pages/                       # Next.js 라우팅 기반 구조
│   ├── admin/
│   │   ├── index.js             # 관리자 대시보드
│   │   ├── login.js             # 관리자 로그인 페이지
│   │   ├── recommendation/      # 추천 여행지 관리 페이지
│   │   ├── reports/             # 신고 관리 (리뷰/채팅)
│   │   └── users/               # 사용자 관리
│   ├── api/                     # API Routes (서버 함수)
│   │   ├── admin/               # 인증/로그아웃 API
│   │   ├── chatReports/         # 채팅 신고 처리 API
│   │   ├── reviewReports/       # 리뷰 신고 처리 API
│   ├── _app.js                  # 글로벌 App 설정
│   ├── 404.js                   # Not Found 페이지
│   └── index.js                 # 루트 페이지 (리다이렉트 등)
├── public/                      # 정적 파일
├── styles/                      # Tailwind CSS 글로벌 스타일
└── utils/                       # 범용 유틸리티 함수
```

---

## **4. 🧩 핵심 기능**

### **1. 리뷰 & 채팅 신고 관리**

- 사용자로부터 접수된 신고를 Firestore에서 조회
- **리뷰/채팅 신고 목록**을 각각 별도 페이지에서 관리
- 각 항목에 대해 신고 사유, 신고자, 신고 일시, 리뷰/메시지 내용 표시
- 신고 항목에 대해 **두 가지 처리 방식 제공**(트랜잭션 처리):
  - **삭제:** 신고된 리뷰 또는 채팅 메시지와 신고 내역을 모두 삭제
  - 무시(Dismiss): 신고 내역만 삭제, 콘텐츠는 유지
- 삭제 성공 시 실시간 목록에서 제거 (React Query invalidate)

### **2. 사용자 계정 관리**

- 플랫폼 사용자 목록 조회
- 사용자별 리뷰 수, 일정 수, 신고 이력, 상태 표시
- **계정 정지 / 복구 / 삭제** 기능 제공
- 상태 변경은 Firestore에 기록되고 UI에 실시간 반영
- **필터 기능**으로 상태(정상/정지 등)별 사용자 분류 가능
- **CSV 다운로드** 기능으로 사용자 데이터를 파일로 내보낼 수 있음

### **3. 추천 여행지 관리**

- 사용자가 볼 추천 여행지 목록을 직접 추가/수정/삭제
- 여행지명, 위치(주소), 대표 이미지, 설명 등 입력 가능
  - 실제 좌표 변환(지오코딩) 및 지도 렌더링은 클라이언트 앱에서 처리
- 클라이언트에 실시간 반영

### **4. 관리자 대시보드**

- 실시간 통계 요약 카드: 신고 수, 활성 사용자 수 등
- **차트 시각화**
  1. **리뷰 신고 추이 (라인 차트)** – 최근 7일 기준
  2. **채팅 신고 추이 (라인 차트)** – 최근 7일 기준
  3. **사용자 상태 분포 (도넛 차트)** – 정상 / 정지 / 탈퇴 등
     - users_private.status 필드 기준
  4. **작성 콘텐츠 수 추이 (막대 차트)** – 최근 6개월 기준
     - 리뷰 수 & 일정 수 월별 집계
- **최근 신고 테이블**로 콘텐츠 모니터링

> 모든 기능은 관리자 권한이 있는 계정으로 로그인한 경우에만 접근 가능하며, 인증은 Firebase Admin SDK를 통해 서버에서 검증됩니다.

---

## **5. 🔐 관리자 인증 방식**

LoneLeap 관리자 페이지는 사용자 웹앱과 완전히 분리된 인증 구조로 운영되며, 다음과 같은 방식으로 관리자 인증을 처리합니다:

- **Firebase Admin SDK + Firestore 인증 컬렉션 기반**
  - Firestore의 `admins/{email}` 문서에 존재하는 이메일만 관리자 권한 부여
- 로그인 시 서버에서 Firebase ID 토큰을 검증하고, **HttpOnly 쿠키(`admin-auth-token`)에 인증 정보를 저장**
- 모든 인증 검사는 **서버 측에서 처리되며**, 클라이언트에는 인증 상태를 저장하지 않음
- 인증 토큰이 없거나 만료된 경우, 자동으로 `/login` 페이지로 리디렉션됨
- 관리자 사이드바에는 세션 남은 시간을 보여주는 `SessionTimer` 컴포넌트가 포함되어 있어, 세션 만료 전 사용자에게 안내함

---

## \*\*6. 🆕 최근 업데이트 (v3.0.0 – 2025.06.10)

- 관리자 인증 구조 개선 (Firestore 기반 + 쿠키 인증)
- 대시보드 SSR 유틸 함수 분리 (`getStats`, `getChartData`, `getRecentReports`)
- 신고 관리 기능 고도화 (리뷰/채팅 신고 삭제 & 무시 분리, 트랜잭션 처리)
- 사용자 관리 기능 추가 (정지/복구/삭제, 필터, CSV 내보내기)
- 추천 여행지 등록/수정/삭제 기능 정비 및 훅/서비스 분리
- 관리자 대시보드 통계 시각화 구현:
  - 리뷰/채팅 신고 추이 (7일 기준)
  - 사용자 상태 분포 (도넛 차트)
  - 콘텐츠 작성 수 추이 (6개월 기준)
- 공통 UI 컴포넌트 정리 및 모달 구조 개선
- 페이지 전체 반응형 구조 및 SkeletonImage 통합 적용
- 콘솔 로그 정리 및 toast 메시지 전환
- 시멘틱 마크업 개선 및 접근성 대응 강화

---

## **7. 🚀 실행 방법**

```bash
npm install
npm run dev

```

- `http://localhost:3000/admin` 접속 후 로그인
- `.env.local` 파일에 Firebase Admin SDK 관련 설정 필요

---

## **8. 🌍 배포 정보**

- **배포 플랫폼**: Vercel
- **배포 URL**: [https://loneleap-admin.vercel.app/admin](https://loneleap-admin.vercel.app/)

## **9. ✨ 참고사항**

- 이 프로젝트는 신입 프론트엔드 개발자의 포트폴리오 용도로 제작되었습니다.
- 실사용보다는 기술 구현, 인증 흐름, SSR 구조 구현에 초점이 맞춰져 있습니다.

---

## 📘 관련 문서

- 클라이언트 사이트 저장소: https://github.com/devyuu08/loneleap.git
- 전체 구조 및 연동 흐름은 Notion 문서 참조 예정

---

## **🧑‍💻 개발자 정보**

- 이름: 정유진
- GitHub 프로필: [github.com/devyuu08](https://github.com/devyuu08)
- 이메일: devyuu08@gmail.com
